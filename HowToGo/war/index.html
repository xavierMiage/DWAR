<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <LINK rel=stylesheet type="text/css" href="style.css">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByVeSjVFXe2eReHcTHofh0B2uRApRaklM">
    </script>
    <script type="text/javascript">
	    var directionsDisplay;
	    var directionsService = new google.maps.DirectionsService();
	    var map;
	    var result;
	
	    function initialize() {
	      directionsDisplay = new google.maps.DirectionsRenderer();
	      var nantes = new google.maps.LatLng(47.21837, -1.55362);
	      var mapOptions = {
	        zoom:15,
	        center: nantes
	      }
	      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
	      directionsDisplay.setMap(map);
	    }
	
	    function myJsonMethod() {
	    	alert("jsonmethod");
	    	
	    };
	    
	    function test(data) {
	    		alert(data);
	    };
	    
	    function calcRoute() {
	      var start = document.getElementById("depart").value;
	      var end = document.getElementById("arrivee").value;
	      
	      // Tan
	      
		    $.ajax({
		    	type: "GET",
		        url: "tan",
		        data: { nom: start},
		    	success: function(data) {
			    	$("body").append(data);
			    },
			    error : function(jqXHR, status, exception) {
			    	alert("error : " + status + " / " + exception);
			    }
		    });
	      
	      
		    $.ajax({
		    	type: "GET",
		        url: "itineraire",
		        data: { depart: start, arrive: end},
		    	success: function(data) {
		    		var parsedJSON = $.parseJSON(data);
			    	$("#details_bottom").append("<p>" + parsedJSON.depart + "</p>");
			    	
			    	/*map.Polynine({
			    		path: parcoursBus,//chemin du tracé
			    		strokeColor: "#FF0000",//couleur du tracé
			    		strokeOpacity: 1.0,//opacité du tracé
			    		strokeWeight: 2//grosseur du tracé
			    	});*/
			    },
			    error : function(jqXHR, status, exception) {
			    	alert("error : " + status + " / " + exception);
			    }
		    });
   		  
	      
	      // Google MAP
	      var travelmode
	      if($('input[name=travelmode]:checked').val()=="bike"){
	    	  travelmode=google.maps.TravelMode.BICYCLING;
	      }else if($('input[name=travelmode]:checked').val()=="walk"){
	    	  travelmode=google.maps.TravelMode.WALKING;
	      }else{
	    	  travelmode=google.maps.TravelMode.DRIVING;
	      }
	      var today = new Date();
	      var hour = $("#hour").val();
	      var minute = $("#minute").val();
	      var day = today.getDate();
	      var month = today.getMonth();
	      var year = today.getFullYear();
	      var date = new Date(year,month,day,hour,minute);
	      var request = {
	        origin:start,
	        destination:end,
	        travelMode: travelmode,
	        transitOptions: {
	           departureTime: new Date(1337675679473)
	        },
	        unitSystem: google.maps.UnitSystem.METRIC
	      };
	      directionsService.route(request, function(result, status) {
	        if (status == google.maps.DirectionsStatus.OK) {
			  if($('input[name=travelmode]:checked').val()=="bike"){
				$("#details_top > .subtitle_details").text("A Vélo");
			  }else if($('input[name=travelmode]:checked').val()=="walk"){
			 	$("#details_top > .subtitle_details").text("A Pieds");
			  }else{
			 	$("#details_top > .subtitle_details").text("En Voiture");
			  }
	          directionsDisplay.setDirections(result);
	          var text = "Distance: "+result.routes[0].legs[0].distance.value/1000+"km";
	          text += "<br/>Durée: "+secondsToTime(result.routes[0].legs[0].duration.value);
	          text += "<br/>Coût: "+Math.round(result.routes[0].legs[0].distance.value/1000*$("#carburant").val()*100)/100+"€";
	          $("#details_top > p").text("");
	          $("#details_top > p").append(text);
	        }
	      });
	    }
	    
	    function secondsToTime(secs)
	    {
	        var hours = Math.floor(secs / (60 * 60));
	       
	        var divisor_for_minutes = secs % (60 * 60);
	        var minutes = Math.floor(divisor_for_minutes / 60);
	     
	        var divisor_for_seconds = divisor_for_minutes % 60;
	        var seconds = Math.ceil(divisor_for_seconds);
	       
	        return hours+"h"+minutes;
	    }
	    
	    $.fn.pressEnter = function(fn) {  

	        return this.each(function() {  
	            $(this).bind('enterPress', fn);
	            $(this).keyup(function(e){
	                if(e.keyCode == 13)
	                {
	                  $(this).trigger("enterPress");
	                }
	            })
	        });  
	     };
	    
		google.maps.event.addDomListener(window, 'load', initialize);
      
		$(document).ready(function() {
			$("#map-canvas").height($(window).height()-350);
			//google.maps.event.trigger(map,'resize');
			
			$('.input').pressEnter(function(){
				calcRoute();
				$("#map-canvas").animate({height: "75%"});
				$("#bloc_details").fadeIn();
			});
			
			$('.date_input').pressEnter(function(){
				calcRoute();
				$("#map-canvas").animate({height: "75%"});
				$("#bloc_details").fadeIn();
			});
			
			$("#process").click(function(){
				calcRoute();
				$("#map-canvas").animate({height: "75%"});
				$("#bloc_details").fadeIn();
			});
		     
		     $('.radio_img_travelmode').click(function(){
		    	 $('.radio_img_travelmode').removeClass('travelmode_selected');
		         $(this).addClass('travelmode_selected');
		     });
		     
		     var slide= false;
		     $("#title_details").click(function(){
		    	 if(slide == true){
		    		 $("#bloc_details").animate({width:"47px"});
		    		 slide = false;
		    	 }else{
		    		 $("#bloc_details").animate({width:"300px"});
		    		 slide = true;
		    	 }
		     });
			
		});
      
    </script>
  </head>
  <body>
  	
  	<div id="header">
  		<div id="logo">
  			<div id="h-bckg" class="logo-bckg"></div>
  			<div id="ow-bckg" class="logo-bckg"></div>
  			<div id="to-bckg" class="logo-bckg"></div>
  			<div id="go-bckg" class="logo-bckg"></div>
  			<div id="h" class="logo">H</div>
  			<div id="ow" class="logo">ow</div>
  			<div id="to" class="logo">to</div>
  			<div id="go" class="logo">GO</div>
  		</div>
  		<div id="titre">Comparateur de moyen de transport</div>
  		<!--  form action="connect" method="post">
			Identifiant : <input type="text" name="id"/>
			Mot de passe : <input type="password" name="pwd"/>
			<input type="submit" value="Connexion"/>
		</form>-->
  		<div id="signin">
  			<img id="star" src="img/star.png"/>
  			<p id="sign">Enjoy</p>
  		</div>
  		
  	</div>
  	<div id="bloc_details"/>
  		<div id="title_details_prev"/> << </div>
  		<div id="title_details"/>DETAILS</div>
  		<div id="title_details_next"/> << </div>
  		<div id="details_top" class="details"/>
  			<div class="subtitle_details"></div>
  			<p></p>
  		</div>
  		<div id="details_bottom" class="details"/>
  			<div class="subtitle_details">En Transport en commun</div>
  		</div>
  	</div>
    <div id="map-canvas"/></div>
    <div id="footer">
    	<div id="foot_left">
    		<div id="bloc_left" class="bloc">
    			<div class="bloc_title">Trajet</div>
    			<form>
    				<div class="label">Départ  <input id="depart" class="input" type="text" name="depart"></div>
					<div class="label">Arrivée <input id="arrivee" class="input" type="text" name="arrivee"></div>
					<div id="travelmode">
						<label for="car"><img src="img/car.png" alt="Voiture" class="radio_img_travelmode"/></label>
					    <input class="input_hidden" type="radio" name="travelmode" id="car" value="car"/>
						<label for="bike"><img src="img/bike.png" alt="Vélo" class="radio_img_travelmode"/></label>
					    <input class="input_hidden" type="radio" name="travelmode" id="bike" value="bike"/>
						<label for="walk"><img src="img/walk.png" alt="A pieds" class="radio_img_travelmode"/></label>
					    <input class="input_hidden" type="radio" name="travelmode" id="walk" value="bike"/>
					</div>
					<div id="date">
						<div class="label" id="date_label">heure</div>
						<input class="date_input" id="hour" type="number" step="1" value="0" min="0" max="23">:
						<input class="date_input" id="minute" type="number" step="1" value="0" min="0" max="59">
					</div>
    			</form>
    			<div id="process">GO</div>
    		</div>
    		<img id="cross" src="img/cross.png">
    	</div>
    	<div id="foot_right">
    		<div id="bloc_right" class="bloc">
    			<div class="bloc_title">Trajet</div>
    			<form>
    				<div class="label">Départ  
						<select id="carburant" name="carburant">
						<!-- Cout au Km http://lentreprise.lexpress.fr/gestion-fiscalite/impots-taxes/frais-de-carburant-le-bareme-2014_1524924.html -->
    					<option value="0.1072">Gazoil</option> 
						  <option value="0.1448" selected>Essence</option>
						  <option value="0.094">GPL</option>
						</select>
					</div>
    			</form>
    		</div>
    	</div>
    </div>
  </body>
</html>
